/*! For license information please see main.8da62766.js.LICENSE.txt */
(()=>{"use strict";var e={623:(e,t,n)=>{var r=n(853),a=n(43),l=n(950);function o(e){var t="https://2e51ad72-7b0f-492c-a172-3771d8f293ac.preview.emergentagent.com";const Dt=function(){const[e,t]=(0,a.useState)(null),[n,r]=(0,a.useState)(!0),[l,o]=(0,a.useState)([]),[s,u]=(0,a.useState)(""),[c,f]=(0,a.useState)(!1),[d,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[g,y]=(0,a.useState)(""),[b,v]=(0,a.useState)(""),[w,k]=(0,a.useState)([]),[S,x]=(0,a.useState)(null),[E,C]=(0,a.useState)(""),[N,P]=(0,a.useState)(!1),[_,T]=(0,a.useState)(""),[O,j]=(0,a.useState)(""),[R,z]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=new URLSearchParams(window.location.search).get("token");e&&(localStorage.setItem("authToken",e),window.history.replaceState({},document.title,window.location.pathname));const t=localStorage.getItem("authToken");t?A(t):r(!1)}),[]);const A=async e=>{try{const n=await At.get("".concat(Ft,"/api/user/profile"),{headers:{Authorization:"Bearer ".concat(e)}});t(n.data),p(n.data.is_admin),n.data.is_admin&&L(e)}catch(n){console.error("Failed to fetch user profile:",n),localStorage.removeItem("authToken")}finally{r(!1)}},L=async e=>{try{const t=await At.get("".concat(Ft,"/api/admin/stats"),{headers:{Authorization:"Bearer ".concat(e||localStorage.getItem("authToken"))}});x(t.data)}catch(t){console.error("Failed to fetch admin stats:",t)}},F=async()=>{try{const e=await At.get("".concat(Ft,"/api/admin/users"),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}});k(e.data.users)}catch(e){console.error("Failed to fetch users:",e)}},D=()=>{window.location.href="".concat(Ft,"/api/login/google")},M=async()=>{if(!s.trim()||c)return;f(!0);const e=s.trim();u(""),o((t=>[...t,{type:"user",content:e,timestamp:(new Date).toISOString()}]));try{const t=await At.post("".concat(Ft,"/api/chat"),{message:e},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")),"Content-Type":"application/json"}});o((e=>[...e,{type:"assistant",content:t.data.response,timestamp:t.data.timestamp}]))}catch(a){var t,n,r;console.error("Failed to send message:",a);let e="Sorry, something went wrong. Please try again.";400===(null===(t=a.response)||void 0===t?void 0:t.status)&&null!==(n=a.response)&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.detail&&(e=a.response.data.detail),o((t=>[...t,{type:"error",content:e,timestamp:(new Date).toISOString()}]))}finally{f(!1)}},I=async(e,t)=>{P(!0);try{await At.post("".concat(Ft,"/api/admin/manage-admin"),{email:e,action:t},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")),"Content-Type":"application/json"}}),alert("Admin access ".concat("add"===t?"granted to":"removed from"," ").concat(e)),"add"===t&&C(""),F()}catch(n){console.error("Failed to manage admin access:",n),alert("Failed to manage admin access.")}finally{P(!1)}},U=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"set";z(!0);try{await At.post("".concat(Ft,"/api/admin/user-api-key"),{email:e,api_key:t,action:n},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")),"Content-Type":"application/json"}}),alert("API key ".concat("remove"===n?"removed from":"updated for"," ").concat(e)),"set"===n&&(T(""),j("")),F()}catch(r){console.error("Failed to manage user API key:",r),alert("Failed to manage user API key.")}finally{z(!1)}};return n?(0,Lt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,Lt.jsxs)("div",{className:"text-center",children:[(0,Lt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,Lt.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?(0,Lt.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,Lt.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,Lt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,Lt.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsx)("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:(0,Lt.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Lt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,Lt.jsx)("h1",{className:"text-xl font-semibold text-gray-800",children:"ChatGPT Web App"})]}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[d&&(0,Lt.jsx)("button",{onClick:()=>m(!h),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"Admin Panel"}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Lt.jsx)("img",{src:e.picture,alt:e.name,className:"w-8 h-8 rounded-full"}),(0,Lt.jsx)("span",{className:"text-gray-700 font-medium",children:e.name})]}),(0,Lt.jsx)("button",{onClick:()=>{localStorage.removeItem("authToken"),t(null),o([]),p(!1),m(!1)},className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,Lt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Lt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]})})}),(0,Lt.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[h&&d&&(0,Lt.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-8",children:[(0,Lt.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Admin Panel"}),S&&(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,Lt.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,Lt.jsx)("h3",{className:"font-medium text-blue-900",children:"Total Users"}),(0,Lt.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:S.total_users})]}),(0,Lt.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg",children:[(0,Lt.jsx)("h3",{className:"font-medium text-green-900",children:"Total Chats"}),(0,Lt.jsx)("p",{className:"text-2xl font-bold text-green-600",children:S.total_chats})]}),(0,Lt.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg",children:[(0,Lt.jsx)("h3",{className:"font-medium text-purple-900",children:"Admin Email"}),(0,Lt.jsx)("p",{className:"text-sm font-medium text-purple-600",children:S.admin_email})]})]}),(0,Lt.jsxs)("div",{className:"border-t pt-6",children:[(0,Lt.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Configure API Key"}),(0,Lt.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Configure OpenAI API keys. Leave user email empty to set a default key for all users."}),(0,Lt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,Lt.jsx)("input",{type:"password",placeholder:"OpenAI API Key",value:g,onChange:e=>y(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,Lt.jsx)("input",{type:"email",placeholder:"User Email (optional - for default leave empty)",value:b,onChange:e=>v(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,Lt.jsx)("button",{onClick:async()=>{try{await At.post("".concat(Ft,"/api/admin/configure"),{openai_key:g,user_email:b||null},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken")),"Content-Type":"application/json"}}),alert("API key configured successfully!"),y(""),v("")}catch(e){console.error("Failed to configure API key:",e),alert("Failed to configure API key.")}},className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Configure API Key"})]}),(0,Lt.jsxs)("div",{className:"border-t pt-6 mt-6",children:[(0,Lt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Lt.jsx)("h3",{className:"text-lg font-medium text-gray-800",children:"Users"}),(0,Lt.jsx)("button",{onClick:F,className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"Refresh"})]}),(0,Lt.jsx)("div",{className:"max-h-60 overflow-y-auto",children:w.length>0?(0,Lt.jsx)("div",{className:"space-y-2",children:w.map(((e,t)=>(0,Lt.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border",children:[(0,Lt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Lt.jsx)("img",{src:e.picture,alt:e.name,className:"w-12 h-12 rounded-full"}),(0,Lt.jsxs)("div",{className:"flex-1",children:[(0,Lt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Lt.jsx)("p",{className:"font-medium text-gray-800",children:e.name}),e.is_admin&&(0,Lt.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full",children:"Admin"})]}),(0,Lt.jsx)("p",{className:"text-sm text-gray-600",children:e.email}),(0,Lt.jsx)("div",{className:"flex items-center space-x-2 mt-1",children:e.has_personal_key?(0,Lt.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:"Personal API Key"}):e.has_api_key?(0,Lt.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:"default_admin"===e.api_key_source?"Default Key":"Environment Key"}):(0,Lt.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full",children:"No API Key"})})]})]}),(0,Lt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Lt.jsx)("div",{className:"text-right text-sm text-gray-500",children:(0,Lt.jsx)("p",{children:new Date(e.last_login).toLocaleDateString()})}),(0,Lt.jsxs)("div",{className:"flex flex-col space-y-1",children:[e.has_personal_key?(0,Lt.jsx)("button",{onClick:()=>{return t=e.email,void(window.confirm("Are you sure you want to remove the API key for ".concat(t,"?"))&&U(t,"","remove"));var t},disabled:R,className:"bg-orange-500 text-white px-3 py-1 rounded text-xs hover:bg-orange-600 transition-colors disabled:opacity-50",children:"Remove Key"}):(0,Lt.jsx)("button",{onClick:()=>{T(e.email),document.getElementById("api-key-input").focus()},disabled:R,className:"bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 transition-colors disabled:opacity-50",children:"Assign Key"}),e.is_admin&&e.email!==(null===S||void 0===S?void 0:S.admin_email)&&(0,Lt.jsx)("button",{onClick:()=>{return t=e.email,void(window.confirm("Are you sure you want to remove admin access from ".concat(t,"?"))&&I(t,"remove"));var t},disabled:N,className:"bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 transition-colors disabled:opacity-50",children:"Remove Admin"})]})]})]},t)))}):(0,Lt.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No users found"})})]}),(0,Lt.jsxs)("div",{className:"border-t pt-6 mt-6",children:[(0,Lt.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Assign API Key to User"}),(0,Lt.jsxs)("div",{className:"space-y-3",children:[(0,Lt.jsx)("input",{type:"email",placeholder:"User email",value:_,onChange:e=>T(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:R}),(0,Lt.jsx)("input",{id:"api-key-input",type:"password",placeholder:"OpenAI API Key for this user",value:O,onChange:e=>j(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:R}),(0,Lt.jsx)("button",{onClick:()=>{_.trim()&&O.trim()?U(_.trim(),O.trim(),"set"):alert("Please enter both email and API key")},disabled:R||!_.trim()||!O.trim(),className:"w-full bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:R?"Processing...":"Assign API Key"})]}),(0,Lt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Assign a personal OpenAI API key to a specific user. This will override any default keys."})]}),(0,Lt.jsxs)("div",{className:"border-t pt-6 mt-6",children:[(0,Lt.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-4",children:"Manage Admin Access"}),(0,Lt.jsxs)("div",{className:"flex space-x-2",children:[(0,Lt.jsx)("input",{type:"email",placeholder:"Enter email to grant admin access",value:E,onChange:e=>C(e.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:N}),(0,Lt.jsx)("button",{onClick:()=>{E.trim()?I(E.trim(),"add"):alert("Please enter a valid email address")},disabled:N||!E.trim(),className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Processing...":"Add Admin"})]}),(0,Lt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Grant admin access to users by entering their email address. They must have already signed in at least once."})]})]}),(0,Lt.jsxs)("div",{className:"bg-white rounded-xl shadow-sm h-[600px] flex flex-col",children:[(0,Lt.jsx)("div",{className:"p-4 border-b",children:(0,Lt.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Chat with GPT-4"})}),(0,Lt.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===l.length?(0,Lt.jsxs)("div",{className:"text-center py-12",children:[(0,Lt.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Lt.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Lt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,Lt.jsx)("p",{className:"text-gray-500",children:"Start a conversation with ChatGPT"}),(0,Lt.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Type your message below to get started"})]}):l.map(((e,t)=>(0,Lt.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"),children:(0,Lt.jsx)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("user"===e.type?"bg-blue-600 text-white":"error"===e.type?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:(0,Lt.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})})},t))),c&&(0,Lt.jsx)("div",{className:"flex justify-start",children:(0,Lt.jsx)("div",{className:"bg-gray-100 text-gray-800 px-4 py-2 rounded-lg",children:(0,Lt.jsxs)("div",{className:"flex space-x-1",children:[(0,Lt.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,Lt.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,Lt.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})})]}),(0,Lt.jsx)("div",{className:"p-4 border-t",children:(0,Lt.jsxs)("div",{className:"flex space-x-2",children:[(0,Lt.jsx)("textarea",{value:s,onChange:e=>u(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},placeholder:"Type your message...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:"1",disabled:c}),(0,Lt.jsx)("button",{onClick:M,disabled:!s.trim()||c,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Sending...":"Send"})]})})]})]})]}):(0,Lt.jsx)(i,{clientId:"697473088935-uj8e0365t88dhlopd3f6hp3oh5j9bivp.apps.googleusercontent.com",children:(0,Lt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:(0,Lt.jsxs)("div",{className:"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full mx-4",children:[(0,Lt.jsxs)("div",{className:"text-center mb-8",children:[(0,Lt.jsx)("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,Lt.jsx)("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Lt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,Lt.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"ChatGPT Web App"}),(0,Lt.jsx)("p",{className:"text-gray-600",children:"Sign in with Google to start chatting"})]}),(0,Lt.jsxs)("button",{onClick:D,className:"w-full bg-white border-2 border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 hover:border-gray-400 transition-colors flex items-center justify-center space-x-2",children:[(0,Lt.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,Lt.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,Lt.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,Lt.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,Lt.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,Lt.jsx)("span",{children:"Sign in with Google"})]}),(0,Lt.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500",children:(0,Lt.jsx)("p",{children:"Secure authentication powered by Google"})})]})})})};l.createRoot(document.getElementById("root")).render((0,Lt.jsx)(a.StrictMode,{children:(0,Lt.jsx)(Dt,{})}))})();
//# sourceMappingURL=main.8da62766.js.map